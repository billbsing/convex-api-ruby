<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Convex::API - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
<div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  <p class="link">Object
</div>

    
    
    
<!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    <li ><a href="#method-c-new">::new</a>
    <li ><a href="#method-i-create_account">#create_account</a>
    <li ><a href="#method-i-get_account_info">#get_account_info</a>
    <li ><a href="#method-i-query">#query</a>
    <li ><a href="#method-i-request_funds">#request_funds</a>
    <li ><a href="#method-i-submit">#submit</a>
    <li ><a href="#method-i-transaction_get">#transaction_get</a>
    <li ><a href="#method-i-transaction_post">#transaction_post</a>
    <li ><a href="#method-i-transaction_prepare">#transaction_prepare</a>
    <li ><a href="#method-i-transaction_submit">#transaction_submit</a>
    <li ><a href="#method-i-transfer">#transfer</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Convex::API">
  <h1 id="class-Convex::API" class="class">
    class Convex::API
  </h1>

  <section class="description">
    
  </section>

  <section id="5Buntitled-5D" class="documentation-section">



    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      <div id="attribute-i-url" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">url</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
    </section>


     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-new" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(url)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Creates a new <a href="API.html"><code>API</code></a> object. You need to pass the network URL of the <a href="../Convex.html"><code>Convex</code></a> network</p>

<p>At the moment this is <a href="https://convex.world">https://convex.world</a></p>

<h4 id="method-c-new-label-Example">Example<span><a href="#method-c-new-label-Example">&para;</a> <a href="#top">&uarr;</a></span></h4>

<pre class="ruby"><span class="ruby-identifier">convex</span> = <span class="ruby-constant">Convex</span><span class="ruby-operator">::</span><span class="ruby-constant">API</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;https://convex.world&#39;</span>)
</pre>

          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/convex/api.rb, line 22</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">url</span>)
  <span class="ruby-ivar">@url</span> = <span class="ruby-identifier">url</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-create_account" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">create_account</span><span
            class="method-args">(key_pair)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Creates a new account, using the provided <code>KeyPair</code>.</p>
<dl class="rdoc-list note-list"><dt>key_pair
<dd>
<p>A valid <code>Convex::KeyPair</code> object that contains a private and public key.</p>
</dd><dt>returns
<dd>
<p>A <code>Convex::Account</code> object.</p>
</dd></dl>

<h4 id="method-i-create_account-label-Example">Example<span><a href="#method-i-create_account-label-Example">&para;</a> <a href="#top">&uarr;</a></span></h4>

<pre class="ruby"><span class="ruby-comment"># create a random key pair value</span>
<span class="ruby-identifier">key_pair</span> = <span class="ruby-constant">Convex</span><span class="ruby-operator">::</span><span class="ruby-constant">KeyPair</span>.<span class="ruby-identifier">new</span>

<span class="ruby-identifier">account</span> = <span class="ruby-identifier">convex</span>.<span class="ruby-identifier">create_account</span>(<span class="ruby-identifier">key_pair</span>)
<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;my new address is #{account.address}&quot;</span>
</pre>

          <div class="method-source-code" id="create_account-source">
            <pre><span class="ruby-comment"># File lib/convex/api.rb, line 41</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_account</span>(<span class="ruby-identifier">key_pair</span>)
  <span class="ruby-identifier">account_uri</span> = <span class="ruby-constant">URI</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">url</span>, <span class="ruby-string">&#39;/api/v1/createAccount&#39;</span>))
  <span class="ruby-identifier">data</span> = {
    <span class="ruby-value">&#39;accountKey&#39;:</span> <span class="ruby-identifier">key_pair</span>.<span class="ruby-identifier">public_key</span>
  }
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">transaction_post</span>(<span class="ruby-identifier">account_uri</span>, <span class="ruby-identifier">data</span>)
  <span class="ruby-identifier">address</span> = <span class="ruby-identifier">result</span>[<span class="ruby-string">&#39;address&#39;</span>].<span class="ruby-identifier">to_i</span>
  <span class="ruby-keyword">return</span> <span class="ruby-constant">Convex</span><span class="ruby-operator">::</span><span class="ruby-constant">Account</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key_pair</span>, <span class="ruby-identifier">address</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-get_account_info" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">get_account_info</span><span
            class="method-args">(address)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Get account infomation.</p>
<dl class="rdoc-list note-list"><dt>address
<dd>
<p>Address of the account to get the information for.</p>
</dd><dt>returns
<dd>
<p>The result from calling the account information <a href="API.html"><code>API</code></a> on the <a href="../Convex.html"><code>Convex</code></a> network.</p>
</dd></dl>

<h4 id="method-i-get_account_info-label-Example">Example<span><a href="#method-i-get_account_info-label-Example">&para;</a> <a href="#top">&uarr;</a></span></h4>

<pre class="ruby"><span class="ruby-identifier">info</span> = <span class="ruby-identifier">convex</span>.<span class="ruby-identifier">get_account_info</span>(<span class="ruby-identifier">account</span>.<span class="ruby-identifier">address</span>)
<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;account info #{info}&quot;</span>
</pre>

          <div class="method-source-code" id="get_account_info-source">
            <pre><span class="ruby-comment"># File lib/convex/api.rb, line 120</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">get_account_info</span>(<span class="ruby-identifier">address</span>)
  <span class="ruby-identifier">info_uri</span> =  <span class="ruby-constant">URI</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">url</span>, <span class="ruby-node">&quot;/api/v1/accounts/#{address}&quot;</span>))
  <span class="ruby-identifier">transaction_get</span>(<span class="ruby-identifier">info_uri</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-query" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">query</span><span
            class="method-args">(transaction, address=9)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Query the <a href="../Convex.html"><code>Convex</code></a> network with a <strong>convex-lisp</strong> statement.</p>

<p>All queries to the network are free, and you do not need an account to sign the transaction.</p>
<dl class="rdoc-list note-list"><dt>transaction
<dd>
<p>transaction to execute as a query</p>
</dd><dt>address
<dd>
<p>Optional account address to run the query from.</p>
</dd><dt>returns
<dd>
<p>The query result</p>
</dd></dl>

<h4 id="method-i-query-label-Example">Example<span><a href="#method-i-query-label-Example">&para;</a> <a href="#top">&uarr;</a></span></h4>

<pre class="ruby"><span class="ruby-identifier">account</span> = <span class="ruby-identifier">convex</span>.<span class="ruby-identifier">create_account</span>(<span class="ruby-identifier">key_pair</span>)
<span class="ruby-identifier">amount</span> = <span class="ruby-identifier">convex</span>.<span class="ruby-identifier">query</span>(<span class="ruby-string">&#39;*balance*&#39;</span>, <span class="ruby-identifier">account</span>.<span class="ruby-identifier">address</span>)
<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;My account has #{amount} coins&quot;</span>
</pre>

          <div class="method-source-code" id="query-source">
            <pre><span class="ruby-comment"># File lib/convex/api.rb, line 98</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">query</span>(<span class="ruby-identifier">transaction</span>, <span class="ruby-identifier">address</span>=<span class="ruby-value">9</span>)
  <span class="ruby-identifier">query_uri</span> = <span class="ruby-constant">URI</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">url</span>, <span class="ruby-string">&#39;/api/v1/query&#39;</span>))
  <span class="ruby-identifier">data</span> = {
    <span class="ruby-string">&#39;source&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">transaction</span>,
    <span class="ruby-string">&#39;address&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-node">&quot;##{address}&quot;</span>,
    <span class="ruby-string">&#39;lang&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;convex-lisp&quot;</span>
  }
  <span class="ruby-identifier">transaction_post</span>(<span class="ruby-identifier">query_uri</span>, <span class="ruby-identifier">data</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-request_funds" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">request_funds</span><span
            class="method-args">(account, amount=0)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Request funds from the test network. At the moment this will work since we are using a test network.</p>

<p>The amount of funds requested is returned.</p>
<dl class="rdoc-list note-list"><dt>account
<dd>
<p>The account to request funds for.</p>
</dd><dt>amount
<dd>
<p>Optional amount to request. If none provided then request the default amount.</p>
</dd><dt>returns
<dd>
<p>The amount of funds requested.</p>
</dd></dl>

<h4 id="method-i-request_funds-label-Example">Example<span><a href="#method-i-request_funds-label-Example">&para;</a> <a href="#top">&uarr;</a></span></h4>

<pre class="ruby"><span class="ruby-identifier">account</span> = <span class="ruby-identifier">convex</span>.<span class="ruby-identifier">create_account</span>(<span class="ruby-identifier">key_pair</span>)
<span class="ruby-identifier">amount</span> = <span class="ruby-identifier">convex</span>.<span class="ruby-identifier">request_funds</span>(<span class="ruby-identifier">account</span>)
<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;I have requested #{amount} coins for my new account at #{account.address}&quot;</span>
</pre>

          <div class="method-source-code" id="request_funds-source">
            <pre><span class="ruby-comment"># File lib/convex/api.rb, line 69</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">request_funds</span>(<span class="ruby-identifier">account</span>, <span class="ruby-identifier">amount</span>=<span class="ruby-value">0</span>)
  <span class="ruby-identifier">amount</span> = <span class="ruby-constant">Convex</span><span class="ruby-operator">::</span><span class="ruby-constant">DEFAULT_REQUEST_FUND_AMOUNT</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">amount</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">faucet_uri</span> = <span class="ruby-constant">URI</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">url</span>, <span class="ruby-string">&#39;/api/v1/faucet&#39;</span>))
  <span class="ruby-identifier">data</span> = {
    <span class="ruby-value">&#39;address&#39;:</span> <span class="ruby-node">&quot;##{account.address}&quot;</span>,
    <span class="ruby-value">&#39;amount&#39;:</span> <span class="ruby-identifier">amount</span>
  }
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">transaction_post</span>(<span class="ruby-identifier">faucet_uri</span>, <span class="ruby-identifier">data</span>)
  <span class="ruby-identifier">result</span>[<span class="ruby-string">&#39;amount&#39;</span>].<span class="ruby-identifier">to_i</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-submit" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">submit</span><span
            class="method-args">(transaction, account)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Submit a transaction to the network. As this transcation will change the network state you will need to have an account that can sign the transaction and also have sufficient funds in the account.</p>
<dl class="rdoc-list note-list"><dt>transaction
<dd>
<p>Transaction to execute on the network.</p>
</dd><dt>account
<dd>
<p>A valid <code>Convex::Account</code> object.</p>
</dd><dt>returns
<dd>
<p>The result from the transaction.</p>
</dd></dl>

<h4 id="method-i-submit-label-Example">Example<span><a href="#method-i-submit-label-Example">&para;</a> <a href="#top">&uarr;</a></span></h4>

<pre>result = convex.submit(&quot;map inc [1 2 3 4]&quot;), account)
puts &quot;my result is #{result}&quot;</pre>

          <div class="method-source-code" id="submit-source">
            <pre><span class="ruby-comment"># File lib/convex/api.rb, line 141</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">submit</span>(<span class="ruby-identifier">transaction</span>, <span class="ruby-identifier">account</span>)
  <span class="ruby-identifier">prepare_data</span> = <span class="ruby-identifier">transaction_prepare</span>(<span class="ruby-identifier">transaction</span>, <span class="ruby-identifier">account</span>.<span class="ruby-identifier">address</span>)
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">prepare_data</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&#39;hash&#39;</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Convex</span><span class="ruby-operator">::</span><span class="ruby-constant">APIError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">500</span>, <span class="ruby-string">&#39;no hash value&#39;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">hash_data</span> = <span class="ruby-identifier">prepare_data</span>[<span class="ruby-string">&#39;hash&#39;</span>]
  <span class="ruby-identifier">signed_data</span> = <span class="ruby-identifier">account</span>.<span class="ruby-identifier">sign</span>(<span class="ruby-identifier">hash_data</span>)
  <span class="ruby-identifier">transaction_submit</span>(<span class="ruby-identifier">account</span>.<span class="ruby-identifier">address</span>, <span class="ruby-identifier">account</span>.<span class="ruby-identifier">public_key</span>, <span class="ruby-identifier">hash_data</span>, <span class="ruby-identifier">signed_data</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-transfer" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">transfer</span><span
            class="method-args">(from_account, to_address, amount)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Transfer funds from an account to a given address.</p>
<dl class="rdoc-list note-list"><dt>from_account
<dd>
<p>The valid <code>Convex::Account</code> object that has sufficient funds to transfer from.</p>
</dd><dt>to_address
<dd>
<p>The address to send the funds to.</p>
</dd><dt>amount
<dd>
<p>The amount to send to the <strong>to_address</strong></p>
</dd></dl>

<h4 id="method-i-transfer-label-Example">Example<span><a href="#method-i-transfer-label-Example">&para;</a> <a href="#top">&uarr;</a></span></h4>

<pre class="ruby"><span class="ruby-identifier">to_address</span> = <span class="ruby-value">9</span>
<span class="ruby-identifier">amount</span> = <span class="ruby-identifier">convex</span>.<span class="ruby-identifier">transfer</span>(<span class="ruby-identifier">account</span>, <span class="ruby-identifier">to_address</span>, <span class="ruby-value">10000</span>)
<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;I have sent #{amount} to address #{to_address}&quot;</span>
</pre>

          <div class="method-source-code" id="transfer-source">
            <pre><span class="ruby-comment"># File lib/convex/api.rb, line 166</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">transfer</span>(<span class="ruby-identifier">from_account</span>, <span class="ruby-identifier">to_address</span>, <span class="ruby-identifier">amount</span>)
  <span class="ruby-identifier">transaction</span> = <span class="ruby-node">&quot;(transfer ##{to_address} #{amount})&quot;</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">submit</span>(<span class="ruby-identifier">transaction</span>, <span class="ruby-identifier">from_account</span>)
  <span class="ruby-identifier">result</span>[<span class="ruby-string">&#39;value&#39;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&#39;value&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Protected Instance Methods</h3>
       </header>

      <div id="method-i-transaction_get" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">transaction_get</span><span
            class="method-args">(uri)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="transaction_get-source">
            <pre><span class="ruby-comment"># File lib/convex/api.rb, line 208</span>
          <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">transaction_get</span>(<span class="ruby-identifier">uri</span>)
  <span class="ruby-identifier">response</span> = <span class="ruby-constant">HTTP</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">uri</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">!=</span> <span class="ruby-value">200</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Convex</span><span class="ruby-operator">::</span><span class="ruby-constant">APIError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">response</span>.<span class="ruby-identifier">code</span>, <span class="ruby-identifier">response</span>.<span class="ruby-identifier">body</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">body</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&#39;errorCode&#39;</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Convex</span><span class="ruby-operator">::</span><span class="ruby-constant">APIError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">result</span>[<span class="ruby-string">&#39;errorCode&#39;</span>], <span class="ruby-identifier">result</span>[<span class="ruby-string">&#39;value&#39;</span>])
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-transaction_post" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">transaction_post</span><span
            class="method-args">(uri, data)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="transaction_post-source">
            <pre><span class="ruby-comment"># File lib/convex/api.rb, line 196</span>
          <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">transaction_post</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">data</span>)
  <span class="ruby-identifier">response</span> = <span class="ruby-constant">HTTP</span>.<span class="ruby-identifier">post</span>(<span class="ruby-identifier">uri</span>, {<span class="ruby-string">&#39;json&#39;</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">data</span>})
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">!=</span> <span class="ruby-value">200</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Convex</span><span class="ruby-operator">::</span><span class="ruby-constant">APIError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">response</span>.<span class="ruby-identifier">code</span>, <span class="ruby-identifier">response</span>.<span class="ruby-identifier">body</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">body</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&#39;errorCode&#39;</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Convex</span><span class="ruby-operator">::</span><span class="ruby-constant">APIError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">result</span>[<span class="ruby-string">&#39;errorCode&#39;</span>], <span class="ruby-identifier">result</span>[<span class="ruby-string">&#39;value&#39;</span>])
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-transaction_prepare" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">transaction_prepare</span><span
            class="method-args">(transaction, address, sequence_number=nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="transaction_prepare-source">
            <pre><span class="ruby-comment"># File lib/convex/api.rb, line 172</span>
          <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">transaction_prepare</span>(<span class="ruby-identifier">transaction</span>, <span class="ruby-identifier">address</span>, <span class="ruby-identifier">sequence_number</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">prepare_uri</span> = <span class="ruby-constant">URI</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">url</span>, <span class="ruby-string">&#39;/api/v1/transaction/prepare&#39;</span>))
  <span class="ruby-identifier">data</span> = {
    <span class="ruby-string">&#39;address&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-node">&quot;##{address}&quot;</span>,
    <span class="ruby-string">&#39;source&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">transaction</span>,
    <span class="ruby-string">&#39;lang&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;convex-lisp&quot;</span>
  }
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">sequence_number</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;sequence&#39;</span>] = <span class="ruby-identifier">sequence_number</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">transaction_post</span>(<span class="ruby-identifier">prepare_uri</span>, <span class="ruby-identifier">data</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-transaction_submit" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">transaction_submit</span><span
            class="method-args">(address, public_key, hash_data, signed_data)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="transaction_submit-source">
            <pre><span class="ruby-comment"># File lib/convex/api.rb, line 185</span>
          <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">transaction_submit</span>(<span class="ruby-identifier">address</span>, <span class="ruby-identifier">public_key</span>, <span class="ruby-identifier">hash_data</span>, <span class="ruby-identifier">signed_data</span>)
  <span class="ruby-identifier">submit_uri</span> = <span class="ruby-constant">URI</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">url</span>, <span class="ruby-string">&#39;/api/v1/transaction/submit&#39;</span>))
  <span class="ruby-identifier">data</span> = {
    <span class="ruby-string">&#39;address&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-node">&quot;##{address}&quot;</span>,
    <span class="ruby-string">&#39;accountKey&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">public_key</span>,
    <span class="ruby-value">&#39;hash&#39;:</span> <span class="ruby-identifier">hash_data</span>,
    <span class="ruby-value">&#39;sig&#39;:</span> <span class="ruby-identifier">signed_data</span>
  }
  <span class="ruby-identifier">transaction_post</span>(<span class="ruby-identifier">submit_uri</span>, <span class="ruby-identifier">data</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.3.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

